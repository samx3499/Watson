scenario:
  id: "phishing-credential-harvesting-001"
  name: "Phishing Credential Harvesting via Malicious Website"
  attack_type: "Phishing"
  difficulty: 6
  date_discovered: "2024-03-16"
  affected_system: "Windows 11 Enterprise (Build 22621)"
  user: "sarah.mitchell@acmecorp.com"
  workstation: "WS-ACME-0421"

company_background: |
  ACME Financial Services is a regional fintech company specializing in payment
  processing and financial data analytics. The company operates 150 Windows-based
  workstations across three locations:
  - Headquarters: Chicago, IL (100 workstations)
  - Data center: Des Moines, IA (35 workstations)
  - Regional office: Atlanta, GA (15 workstations)
  
  Business Operations:
  - Payment processing platform for small and medium businesses
  - Financial data analytics and reporting services
  - Customer portal and API services
  - Compliance and regulatory reporting
  
  Infrastructure:
  - 1 public-facing web server (Windows Server 2019) hosting customer portal
  - Active Directory domain: ACME.local
  - 145 domain-joined Windows workstations (mix of Windows 10 Pro and Windows 11 Enterprise)
  - 5 standalone workstations (contractors/guests)
  - File server: \\fileserver01 (Windows Server 2019)
  - Email server: Microsoft Exchange 2019 on-premises
  - Database servers: SQL Server 2019 (financial transaction data)
  
  Software Environment:
  - Remote Management: ConnectWise Control (legitimate RMM tool used by IT department)
  - Browsers: Microsoft Edge (primary), Google Chrome (secondary)
  - Office Suite: Microsoft Office 365 (Outlook, Word, Excel, PowerPoint)
  - PDF Reader: Adobe Acrobat Reader DC (standard deployment)
  - Financial Software: QuickBooks Enterprise, Sage Intacct
  - Development Tools: Visual Studio Code, Git for Windows
  - Antivirus: Windows Defender + Microsoft Defender for Endpoint
  - Backup: Veeam Backup & Replication
  - Monitoring: PRTG Network Monitor
  
  User Base:
  - 142 active domain users
  - 8 service accounts
  - Normal business hours: 08:00-17:00 CST (14:00-23:00 UTC)
  - IT department: 5 users (frequent use of ConnectWise Control for remote support)
  - Development team: 18 users (Visual Studio Code, Git usage)
  - Sales team: 25 users (frequent browser usage, external website visits, CRM access)
  - Finance/Accounting: 12 users (QuickBooks, Sage Intacct, financial data access)
  - Operations: 35 users (payment processing platform access)
  - Customer Support: 20 users (customer portal access)
  - Management: 12 users (access to sensitive financial data and reports)
  - HR: 8 users (access to employee PII)
  - Compliance: 7 users (regulatory reporting, audit access)
  
  Normal Activity Patterns:
  - IT staff regularly use ConnectWiseControl.exe for remote support (legitimate)
  - Development team frequently use git.exe and code.exe (legitimate)
  - Sales team frequently visits external websites (legitimate business research, CRM)
  - Finance team regularly access QuickBooks and Sage Intacct applications
  - Users regularly access internal file shares (\\fileserver01)
  - Browser history shows normal business-related website visits
  - Multiple users access SharePoint for document collaboration
  - Regular scheduled tasks for backups, database maintenance, and system updates
  - Normal logon patterns during business hours (08:00-17:00 CST)
  - Occasional after-hours access by IT staff for maintenance
  - Regular database queries and financial transaction processing

initial_detection: |
  On 2024-03-16 at 09:15:00 UTC, network monitoring detected outbound HTTPS
  connections from workstation WS-ACME-0421 to IP address 185.220.101.45
  (geolocated to Sofia, Bulgaria). This was flagged as suspicious because:
  - The IP address 185.220.101.45 is not in the approved whitelist
  - Connections occurred on 2024-03-15 at 08:36:20 UTC and 08:37:06 UTC
  - The domain acmecorp-security.com (resolved to this IP) is a spoofed domain
    (one character difference from legitimate acmecorp.com)
  - Browser history analysis revealed visits to this suspicious domain
  - Cookies were set by the phishing domain

timeline_summary: |
  2024-03-15 08:36:18 UTC - User navigated to phishing website (acmecorp-security.com)
  2024-03-15 08:36:20 UTC - Browser connected to phishing site (185.220.101.45)
  2024-03-15 08:36:20 UTC - Phishing page loaded, cookies set
  2024-03-15 08:37:05 UTC - User entered credentials on phishing page
  2024-03-15 08:37:06 UTC - Credentials transmitted to attacker C2 server
  2024-03-15 08:37:15 UTC - Browser session ended

ground_truth:
  note: |
    IMPORTANT: In a real Windows environment, there are MILLIONS of forensic artifacts
    (MFT entries, USN Journal entries, Event Log entries, Registry keys, etc.) from
    normal user activity across 150 workstations and 142 users. The artifacts listed
    below are THE SUSPICIOUS ENTRIES (IOCs) that indicate the phishing attack. The
    agent must identify these specific indicators among the vast amount of normal
    activity. Many users perform normal activities (ConnectWise Control usage by IT
    staff, Git usage by developers, QuickBooks/Sage Intacct by finance team, normal
    PDF opens, regular browser usage, file share access). The agent must distinguish
    between benign operations and attack indicators.
  
  what_happened: |
    On 2024-03-15 at 08:36:18 UTC, user sarah.mitchell navigated to a phishing
    website at https://acmecorp-security.com/verify-account. The domain
    'acmecorp-security.com' is a spoofed domain (one character difference from the
    legitimate 'acmecorp.com') designed to mimic the legitimate ACME Corp login page.
    
    At 08:36:20 UTC, Microsoft Edge browser connected to the phishing site hosted
    at IP 185.220.101.45 (Bulgaria). The site loaded and set cookies (session_id
    and tracking_id) in the user's browser. Browser artifacts (history, cookies,
    cache) were created during this session.
    
    At 08:37:05 UTC, the user entered their corporate email address and password
    into the fake login form on the phishing site.
    
    At 08:37:06 UTC, the credentials were transmitted via HTTPS POST request to
    the attacker's server at 185.220.101.45:443. The phishing page then redirected
    the user to the legitimate login page, making the attack less obvious.
    
    At 08:37:15 UTC, the browser session ended. The user's credentials were
    successfully harvested by the attacker.

  attack_method: |
    This was a pure credential harvesting attack with no malware deployed. The
    attacker used:
    - Spoofed domain (acmecorp-security.com) to mimic legitimate site
    - Social engineering (official-looking branding, urgency)
    - Phishing website mimicking legitimate login page
    - HTTPS with valid SSL certificate for legitimacy
    - JavaScript for real-time credential capture
    - Immediate redirect to legitimate site after credential submission

  data_stolen: |
    Based on network analysis and browser artifacts:
    - Corporate email credentials (sarah.mitchell@acmecorp.com)
    - Password entered on phishing form
    - Session tracking information

  indicators_of_compromise:
    suspicious_windows_artifacts: |
      The following are THE SUSPICIOUS ARTIFACTS (IOCs) found in the Windows forensic
      analysis. In reality, there are millions of normal entries across the domain,
      but these specific artifacts indicate the phishing attack:
      
      WINDOWS EVENT LOGS:
      - Security Log Event ID 4624 (08:30:00 UTC): Normal logon for sarah.mitchell
      - System Log Event ID 7034 (08:36:20 UTC): msedge.exe started
      - Application Log Event ID 1000 (08:37:06 UTC): msedge.exe error (possibly from phishing page JavaScript)
      
      MFT ENTRIES:
      - C:\Users\sarah.mitchell\AppData\Local\Microsoft\Edge\User Data\Default\History
        (created 08:36:20 UTC, modified 08:37:15 UTC) - Contains phishing site visit
      - C:\Users\sarah.mitchell\AppData\Local\Microsoft\Edge\User Data\Default\Cookies
        (created/modified 08:36:20 UTC) - Contains phishing site cookies (session_id, tracking_id)
      - C:\Users\sarah.mitchell\AppData\Roaming\Microsoft\Windows\Recent\verify-account.lnk
        (created 08:36:18 UTC) - LNK file pointing to phishing URL
      - C:\Windows\Prefetch\MSEDGE.EXE-ABC123DF.pf (created 08:36:20 UTC) - Edge browser prefetch
      
      USN JOURNAL ENTRIES:
      - USN 12345680 (08:36:20 UTC): Browser History database created/updated
      - USN 12345681 (08:36:20 UTC): Cookies file created for phishing domain
      - USN 12345682 (08:36:18 UTC): verify-account.lnk file created
      
      AMCACHE ENTRIES:
      - msedge.exe execution recorded (first_execution: 08:36:20 UTC, last_execution: 08:37:15 UTC)
      
      PREFETCH FILES:
      - MSEDGE.EXE-ABC123DF.pf showing files accessed during phishing site visit:
        * Edge browser executable
        * History database
        * Cookies database
        * Cache folder
      
      REGISTRY ARTIFACTS:
      - UserAssist: msedge.exe execution (08:36:20 UTC, run_count: 1, focus_time: 55 seconds)
      - Shellbags: Browser data folder access (08:36:20 UTC)
      - RecentDocs: verify-account.url entry (08:36:18 UTC)
      - TypedURLs: https://acmecorp-security.com/verify-account (08:36:18 UTC)
      
      BROWSER ARTIFACTS:
      - Edge History: Visit to https://acmecorp-security.com/verify-account (08:36:20 UTC, duration: 55 seconds)
      - Edge Cookies:
        * session_id cookie for acmecorp-security.com (created 08:36:20 UTC)
        * tracking_id cookie for acmecorp-security.com (created 08:36:20 UTC)
      - Edge Cache:
        * Cached phishing page HTML (f_000001, created 08:36:20 UTC)
        * fake_login_form.js (f_000002, created 08:36:21 UTC)
        * acmecorp_logo.png (f_000003, created 08:36:22 UTC)
      
      LNK FILES:
      - verify-account.lnk pointing to https://acmecorp-security.com/verify-account (created 08:36:18 UTC)
      
      SRUM ENTRIES:
      - msedge.exe network activity (08:36:20 UTC): 2048 bytes sent, 15360 bytes received, 1 connection
      
      JUMP LISTS:
      - msedge.lnk jump list entry for phishing URL (accessed 08:36:18 UTC)

windows_event_logs:
  security_log:
    # Benign entries - normal user activity (examples of normal entries among millions)
    - event_id: 4624
      timestamp: "2024-03-15T08:00:00Z"
      logon_type: 2
      account: "ACME\\john.smith"
      source_ip: "192.168.1.10"
      workstation: "WS-ACME-0010"
      mft_reference: "0x0000000000000001:0x00001000"
      usn: 12345000
      description: "Normal user logon - IT staff (ConnectWise Control user)"
    
    - event_id: 4624
      timestamp: "2024-03-15T08:15:00Z"
      logon_type: 2
      account: "ACME\\jane.doe"
      source_ip: "192.168.1.25"
      workstation: "WS-ACME-0025"
      mft_reference: "0x0000000000000001:0x00001001"
      usn: 12345001
      description: "Normal user logon - Sales team member"
    
    # SUSPICIOUS ENTRY - Related to phishing attack
    - event_id: 4624
      timestamp: "2024-03-15T08:30:00Z"
      logon_type: 2
      account: "ACME\\sarah.mitchell"
      source_ip: "192.168.1.45"
      workstation: "WS-ACME-0421"
      mft_reference: "0x0000000000000001:0x00001234"
      usn: 12345678
      description: "Normal user logon to workstation"
    
    - event_id: 4624
      timestamp: "2024-03-15T08:35:00Z"
      logon_type: 2
      account: "ACME\\bob.jones"
      source_ip: "192.168.1.50"
      workstation: "WS-ACME-0050"
      mft_reference: "0x0000000000000001:0x00001002"
      usn: 12345002
      description: "Normal user logon - Finance department"
    
    - event_id: 5145
      timestamp: "2024-03-15T08:40:00Z"
      account: "ACME\\john.smith"
      share_name: "\\\\fileserver01\\IT"
      source_ip: "192.168.1.10"
      mft_reference: "0x0000000000000001:0x00001003"
      usn: 12345003
      description: "Normal network share access - IT staff"
  
  system_log:
    - event_id: 7034
      timestamp: "2024-03-15T08:20:00Z"
      service_name: "ConnectWiseControl.exe"
      mft_reference: "0x0000000000000001:0x00001004"
      usn: 12345004
      description: "ConnectWise Control started - legitimate IT remote support tool"
    
    - event_id: 7034
      timestamp: "2024-03-15T08:25:00Z"
      service_name: "git.exe"
      mft_reference: "0x0000000000000001:0x00001005"
      usn: 12345005
      description: "Git execution - legitimate development tool"
    
    # SUSPICIOUS ENTRY - Related to phishing attack
    - event_id: 7034
      timestamp: "2024-03-15T08:36:20Z"
      service_name: "msedge.exe"
      mft_reference: "0x0000000000000001:0x00001237"
      usn: 12345681
      description: "Microsoft Edge browser started"
  
  application_log:
    # SUSPICIOUS ENTRY - Related to phishing attack
    - event_id: 1000
      timestamp: "2024-03-15T08:37:06Z"
      application: "msedge.exe"
      faulting_module: "edgehtml.dll"
      mft_reference: "0x0000000000000001:0x00001238"
      usn: 12345682
      description: "Browser error (possibly from phishing page JavaScript)"

mft_entries:
  # SUSPICIOUS ENTRIES - Related to phishing attack
  - file_path: "C:\\Users\\sarah.mitchell\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default\\History"
    mft_entry: 0x0000000000000001:0x00002001
    sequence_number: 1
    created: "2024-03-15T08:36:20Z"
    modified: "2024-03-15T08:37:15Z"
    accessed: "2024-03-15T08:37:15Z"
    size: 1048576
    file_attributes: "ARCHIVE"
    description: "Edge browser history database - contains phishing site visit"
  
  - file_path: "C:\\Users\\sarah.mitchell\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default\\Cookies"
    mft_entry: 0x0000000000000001:0x00002002
    sequence_number: 1
    created: "2024-03-15T08:36:20Z"
    modified: "2024-03-15T08:36:20Z"
    accessed: "2024-03-15T08:36:20Z"
    size: 32768
    file_attributes: "ARCHIVE"
    description: "Edge cookies database - contains phishing site cookies"
  
  - file_path: "C:\\Users\\sarah.mitchell\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\verify-account.lnk"
    mft_entry: 0x0000000000000001:0x00002003
    sequence_number: 1
    created: "2024-03-15T08:36:18Z"
    modified: "2024-03-15T08:36:18Z"
    accessed: "2024-03-15T08:36:18Z"
    size: 2048
    file_attributes: "ARCHIVE"
    description: "LNK file pointing to phishing URL"
  
  - file_path: "C:\\Windows\\Prefetch\\MSEDGE.EXE-ABC123DF.pf"
    mft_entry: 0x0000000000000001:0x00002004
    sequence_number: 1
    created: "2024-03-15T08:36:20Z"
    modified: "2024-03-15T08:36:20Z"
    accessed: "2024-03-15T08:36:20Z"
    size: 98304
    file_attributes: "ARCHIVE"
    description: "Prefetch file for Edge browser execution"

usn_journal_entries:
  # SUSPICIOUS ENTRIES - Related to phishing attack
  - usn: 12345680
    timestamp: "2024-03-15T08:36:20Z"
    file_reference: "0x0000000000000001:0x00002001"
    parent_reference: "0x0000000000000001:0x00001001"
    reason: "FILE_CREATE, DATA_EXTEND"
    source_info: "0x00000000"
    security_id: 1001
    file_attributes: "ARCHIVE"
    file_name: "History"
    description: "Browser history database created/updated"
  
  - usn: 12345681
    timestamp: "2024-03-15T08:36:20Z"
    file_reference: "0x0000000000000001:0x00002002"
    parent_reference: "0x0000000000000001:0x00001001"
    reason: "FILE_CREATE, DATA_EXTEND"
    source_info: "0x00000000"
    security_id: 1001
    file_attributes: "ARCHIVE"
    file_name: "Cookies"
    description: "Cookie created for phishing domain"
  
  - usn: 12345682
    timestamp: "2024-03-15T08:36:18Z"
    file_reference: "0x0000000000000001:0x00002003"
    parent_reference: "0x0000000000000001:0x00001002"
    reason: "FILE_CREATE"
    source_info: "0x00000000"
    security_id: 1001
    file_attributes: "ARCHIVE"
    file_name: "verify-account.lnk"
    description: "LNK file created when user navigated to URL"

amcache_entries:
  # Benign entries - normal program executions (examples)
  - program_id: "{11111111-1111-1111-1111-111111111111}"
    file_path: "C:\\Program Files\\ConnectWise\\Control\\ConnectWiseControl.exe"
    file_size: 5242880
    file_hash: "SHA1: A0A0A0A0A0A0A0A0A0A0A0A0A0A0A0A0A0A0A0A0"
    first_execution: "2024-03-15T08:20:00Z"
    last_execution: "2024-03-15T08:20:00Z"
    execution_count: 1
    description: "ConnectWise Control execution - legitimate IT remote support tool"
  
  - program_id: "{22222222-2222-2222-2222-222222222222}"
    file_path: "C:\\Program Files\\Git\\cmd\\git.exe"
    file_size: 2457600
    file_hash: "SHA1: B1B2B3B4B5B6B7B8B9B0B1B2B3B4B5B6B7B8B9B0B1"
    first_execution: "2024-03-15T08:22:00Z"
    last_execution: "2024-03-15T08:22:00Z"
    execution_count: 1
    description: "Git execution - legitimate development tool"
  
  # SUSPICIOUS ENTRY - Related to phishing attack
  - program_id: "{12345678-1234-1234-1234-123456789012}"
    file_path: "C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe"
    file_size: 2457600
    file_hash: "SHA1: A1B2C3D4E5F6A7B8C9D0E1F2A3B4C5D6E7F8A9B0C1"
    first_execution: "2024-03-15T08:36:20Z"
    last_execution: "2024-03-15T08:37:15Z"
    execution_count: 1
    description: "Edge browser execution recorded in Amcache"

prefetch_files:
  # SUSPICIOUS ENTRY - Related to phishing attack
  - file_path: "C:\\Windows\\Prefetch\\MSEDGE.EXE-ABC123DF.pf"
    executable_path: "C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe"
    run_count: 1
    last_execution: "2024-03-15T08:36:20Z"
    created: "2024-03-15T08:36:20Z"
    accessed: "2024-03-15T08:36:20Z"
    modified: "2024-03-15T08:36:20Z"
    files_accessed:
      - "C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe"
      - "C:\\Users\\sarah.mitchell\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default\\History"
      - "C:\\Users\\sarah.mitchell\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default\\Cookies"
      - "C:\\Users\\sarah.mitchell\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default\\Cache"
    volumes_accessed:
      - "\\Device\\HarddiskVolume1"
    description: "Edge browser prefetch showing files accessed during phishing site visit"

registry_artifacts:
  # SUSPICIOUS ENTRIES - Related to phishing attack
  user_assist:
    - key: "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{CEBFF5CD-ACE2-4F4F-9178-9926F41749EA}\\Count"
      value_name: "HRZR_EHACVQY"
      decoded_name: "msedge.exe"
      last_execution: "2024-03-15T08:36:20Z"
      run_count: 1
      focus_count: 1
      focus_time: 55
      description: "UserAssist entry showing Edge browser execution"
  
  shellbags:
    - key: "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Bags\\1\\Desktop"
      folder_path: "C:\\Users\\sarah.mitchell\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default"
      last_accessed: "2024-03-15T08:36:20Z"
      description: "Shellbag entry showing browser data folder access"
  
  recent_docs:
    - key: "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RecentDocs\\.url"
      value_name: "0"
      value_data: "verify-account.url"
      last_accessed: "2024-03-15T08:36:18Z"
      description: "RecentDocs entry for phishing URL shortcut"
  
  typed_urls:
    - key: "HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\TypedURLs"
      value_name: "url1"
      value_data: "https://acmecorp-security.com/verify-account"
      last_typed: "2024-03-15T08:36:18Z"
      description: "Typed URL entry showing user navigated to phishing site"

browser_artifacts:
  # SUSPICIOUS ENTRIES - Related to phishing attack
  edge_history:
    database: "C:\\Users\\sarah.mitchell\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default\\History"
    entries:
      - url: "https://acmecorp-security.com/verify-account?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"
        title: "ACME Corp - Account Verification"
        visit_count: 1
        typed_count: 0
        last_visit_time: "2024-03-15T08:36:20Z"
        visit_duration: 55
        description: "Phishing site visit recorded in browser history"
  
  edge_cookies:
    database: "C:\\Users\\sarah.mitchell\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default\\Cookies"
    entries:
      - name: "session_id"
        value: "a1b2c3d4e5f6g7h8i9j0"
        host: "acmecorp-security.com"
        path: "/"
        created: "2024-03-15T08:36:20Z"
        expires: "2024-03-22T08:36:20Z"
        description: "Session cookie set by phishing site"
      
      - name: "tracking_id"
        value: "1234567890"
        host: "acmecorp-security.com"
        path: "/"
        created: "2024-03-15T08:36:20Z"
        expires: "2024-03-22T08:36:20Z"
        description: "Tracking cookie set by phishing site"
  
  edge_cache:
    location: "C:\\Users\\sarah.mitchell\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default\\Cache\\Cache_Data"
    cached_files:
      - url: "https://acmecorp-security.com/verify-account"
        cached_file: "f_000001"
        created: "2024-03-15T08:36:20Z"
        size: 15360
        hash: "SHA256: 8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d"
        description: "Cached phishing page HTML"
      
      - url: "https://acmecorp-security.com/fake_login_form.js"
        cached_file: "f_000002"
        created: "2024-03-15T08:36:21Z"
        size: 8192
        description: "JavaScript file from phishing site"
      
      - url: "https://acmecorp-security.com/acmecorp_logo.png"
        cached_file: "f_000003"
        created: "2024-03-15T08:36:22Z"
        size: 24576
        description: "Logo image from phishing site"

lnk_files:
  # SUSPICIOUS ENTRY - Related to phishing attack
  - file_path: "C:\\Users\\sarah.mitchell\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\verify-account.lnk"
    target_path: "https://acmecorp-security.com/verify-account"
    working_directory: ""
    command_line: ""
    created: "2024-03-15T08:36:18Z"
    accessed: "2024-03-15T08:36:18Z"
    modified: "2024-03-15T08:36:18Z"
    description: "LNK file created when user navigated to phishing URL"

srum_entries:
  # SUSPICIOUS ENTRY - Related to phishing attack
  - timestamp: "2024-03-15T08:36:20Z"
    application: "msedge.exe"
    user: "sarah.mitchell"
    cpu_time: 5000
    network_bytes_sent: 2048
    network_bytes_received: 15360
    network_connections: 1
    description: "SRUM entry showing Edge browser network activity"

jump_lists:
  # SUSPICIOUS ENTRY - Related to phishing attack
  - location: "C:\\Users\\sarah.mitchell\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\AutomaticDestinations\\msedge.lnk"
    target: "https://acmecorp-security.com/verify-account"
    accessed: "2024-03-15T08:36:18Z"
    description: "Jump list entry for phishing URL"
